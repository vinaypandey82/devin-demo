#include "tx_definitions.h"

void log_exception_to_db(PaymentRequest *req, const char *msg) {
    EXEC SQL BEGIN DECLARE SECTION;
        char r_id[11]; char r_msg[100]; int r_acc;
    EXEC SQL END DECLARE SECTION;

    strncpy(r_id, req->req_id, 10); r_id[10] = '\0';
    strncpy(r_msg, msg, 99);
    r_acc = req->src_acc;

    EXEC SQL INSERT INTO async_error_logs (req_id, acc_id, error_desc, log_date)
             VALUES (:r_id, :r_acc, :r_msg, CURRENT_TIMESTAMP);
    EXEC SQL COMMIT; 
}
